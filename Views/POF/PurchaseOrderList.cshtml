@model CarrotSystem.Models.ViewModel.ViewPOF

@{
    ViewBag.Title = "Purchase Order List";
    Layout = "_Layout";
}


<h4 class="py-3 breadcrumb-wrapper mb-4">
    @ViewBag.Title
</h4>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">

                <form asp-action="SelectedPurchaseOrderList" id="selectDateForm" class="form-horizontal">

                    <div class="row">

                        <div class="col-md-2">
                            <label>Date From: </label>
                            <div class="input-group" style="width:100%;">
                                <div class="input-group-addon"></div>
                                <input id="datePickerFrom" asp-for="stringDateFrom" type="text" class="form-control" value="@Model.dateFrom.Value.ToString("dd/MM/yyyy")" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <label>Date To: </label>
                            <div class="input-group" style="width:100%;">
                                <div class="input-group-addon"></div>
                                <input id="datePickerTo" asp-for="stringDateTo" type="text" class="form-control" value="@Model.dateTo.Value.ToString("dd/MM/yyyy")" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <label>&nbsp;</label>
                            <div class="input-group" style="width:100%;">
                                <button type="submit" class="btn rounded-pill btn-label-primary"><i class="fa fa-search"></i></button>
                            </div>
                        </div>


                    </div>

                </form>


            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col-sm-2">
                        <div class="input-group">
                            <input class="form-control" type="text" id="searchText" placeholder="Search ...">
                        </div>
                    </div>
                    <div class="col-md-8"></div>
                    <div class="col-md-2"></div>
                </div>
            </div>
            <div class="card-body">

                <table id="dt-purchase-order-list" class="table table-bordered">
                    <thead>
                        <tr>
                            <th class="col-lg-1 col-md-1 col-xs-1">PO Number</th>
                            <th class="col-lg-1 col-md-1 col-xs-1">Supplier</th>
                            <th class="col-lg-1 col-md-1 col-xs-1">Status</th>
                            <th class="col-lg-1 col-md-1 col-xs-1">Sent By</th>
                            <th class="col-lg-1 col-md-1 col-xs-1">Sent On</th>
                            <th class="col-lg-1 col-md-1 col-xs-1">Price</th>
                            <th class="col-lg-2 col-md-2 col-xs-2">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.formList)
                        {
                            <tr ondblclick="ViewDetails('@item.FormId');">

                                <td>@item.Ponumber</td>

                                @if (string.IsNullOrEmpty(item.Supplier))
                                {
                                    <td></td>
                                }
                                else
                                {
                                    <td>@item.Supplier</td>
                                }

                                <td>@item.Status</td>

                                @if (string.IsNullOrEmpty(item.SentBy))
                                {
                                    <td></td>
                                }
                                else
                                {
                                    <td>@item.SentBy</td>
                                }

                                <td>@item.SentOn.ToString("dd/MM/yyyy")</td>

                                <td>@item.Price.ToString("$ #,##0.##")</td>

                                <td class="text-center">
                                    <a class="btn btn-icon btn-primary" id="viewBtn_@item.FormId" asp-action="ViewOrder" asp-controller="POF" asp-route-id="@item.FormId"><i class="fa fa-search"></i></a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>


@section PageScripts
{
    <script>

        MenuActive("", "POF", "PurchaseOrderList");

        $(document).ready(function () 
        {
            //DataTable Configuration
            let dataTable = $('#dt-purchase-order-list').DataTable({
                'responsive': true,
                'paging': true,
                'lengthChange': false,
                'displayLength': 20,
                'searching': true,
                'ordering': true,
                'info': false,
                'autoWidth': false,
                "order": [[0, 'desc']],
                "dom": '<"top"i>rt<"bottom"p><"clear">'
            })

            $('#searchText').on('keyup', function () {
                dataTable.search($('#searchText').val()).draw();
            });
        });

        //Date picker
        $('#datePickerFrom').datepicker({
            autoclose: true,
            todayHighlight: true,
            format: 'dd/mm/yyyy'
        });

        $('#datePickerTo').datepicker({
            autoclose: true,
            todayHighlight: true,
            format: 'dd/mm/yyyy'
        });

        function ViewDetails(dataId) 
        {
            var btnId = "viewBtn_" + dataId;
            document.getElementById(btnId).click();

        };

        function sendDateForm() 
        {
            document.getElementById("selectDateForm").submit();
        };

        function DeleteModel(dataId) 
        {
            Swal.fire({
                title: "Do you want to remove this Purchase order form?",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            })
                .then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                            type: "POST",
                            url: "/POF/DeletePOF?pId=" + eval(dataId),
                            contentType: "application/json",
                            dataType: "json",
                            success: function (response) {
                                location.reload(true);
                            }
                        });
                    }
                });
        };

    </script>
}